# アクティブコンテキスト

## 現在の開発フェーズ

### 完了した実装

- SwitchBot APIクライアントの基本機能
  - HMAC認証
  - デバイス一覧取得
  - エラーハンドリング
- プロジェクト設計の更新
  - ぴよログデータ取得の設計
  - 天気データ統合の設計
  - データベーススキーマ設計
- OpenWeatherMap API クライアントの基本実装
  - 指定地点の天気情報取得
  - 日本語での天気情報提供
  - 引数による位置指定機能
  - 環境変数によるAPIキー管理

### 進行中の作業

- APIクライアント拡張
  - Google Drive API統合
  - データ同期処理の実装
- Cloudflare Workersの実装準備
  - データ収集バッチの設計
  - スケジュール実行の設定
  - マルチソースデータ統合

### 今後の実装予定

1. データ収集基盤の構築
   - OpenWeatherMap APIクライアント実装
   - Google Drive APIクライアント実装
   - ぴよログデータパーサー実装
   - データ同期バッチ処理の実装

2. 追加情報源の検討と実装
   - 予防接種スケジュールデータ連携
   - 児童館・子育て支援センター開館情報
   - 健診スケジュール管理
   - 公園混雑状況データ収集
   - 子育て支援イベント情報統合

3. データベース構築
   - テーブル作成
     - 環境データテーブル
     - 天気データテーブル
     - 育児記録テーブル
   - インデックス設計
   - 初期データ移行計画

4. Grafana設定
   - ダッシュボード設計
   - データソース連携
   - アラート設定

5. Terraformによるインフラ構築
   - インフラストラクチャのコード化
   - Cloudflare Workersのプロビジョニング
   - MySQLデータベースのセットアップ
   - Grafanaダッシュボードの定義エクスポート
   - 環境ごとの設定分離

## 現在の検討事項

### 技術的な決定事項

1. データ収集頻度
   - 環境データ: 5分間隔
   - デバイスステータス: 1分間隔

2. データ保持期間
   - 詳細データ: 3ヶ月
   - 集計データ: 1年

### 未解決の課題

1. インフラストラクチャ
   - Terraformモジュールの設計方針
   - 状態管理の方法（リモートバックエンド）
   - プロビジョニングの自動化戦略
   - 環境間の設定差分管理

2. データ収集
   - ぴよログデータの形式定義
   - Google Driveの監視頻度設定
   - 天気データの更新頻度設定
   - 追加情報源のAPI/データフォーマット調査
   - 各種データの更新頻度最適化

3. データベース
   - パーティショニング戦略
   - バックアップスケジュール
   - リプリケーション設定
   - データ保持期間の決定

4. アプリケーション
   - エラー通知の方法
   - リトライ戦略
   - データ整合性の確保

## 次のステップ

1. API統合の実装
   - OpenWeatherMap APIクライアント開発
   - Google Drive APIクライアント開発
   - ぴよログデータパーサー開発

2. データベース環境構築
   - さくらのエンハンスドデータベースのセットアップ
   - テーブル作成
   - 初期データ投入

3. データ同期処理の実装
   - バッチ処理の開発
   - スケジューリング設定
   - エラーハンドリング実装

4. Cloudflare Workers開発
   - 開発環境整備
   - デプロイパイプライン構築

5. Grafana設定
   - データソース接続
   - ダッシュボードテンプレート作成
   - アラートルール定義
   - テスト環境整備

6. インフラストラクチャのコード化
   - Terraformプロジェクト構成
   - 基本モジュールの実装
   - プロビジョニングの自動化
   - 環境設定の分離
